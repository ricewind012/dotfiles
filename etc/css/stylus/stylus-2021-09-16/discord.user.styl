/* ==UserStyle==
@name           Discord
@namespace      github.com/openstyles/stylus
@version        1.0.0
@description    A new userstyle
@author         Me

@preprocessor stylus

@var text sidebar-width "Sidebar - width" 240px
@var checkbox sidebar-overlay "Sidebar - overlay" 1
@var text channels-padding "Channels - padding" 4px
@var checkbox channels-compact "Channels - compact" 1
@var text header-height "Header height" 48px
@var text header-icon-size "Header icon size" 24px

@var text avatar-border-radius "Avatar border radius" 8px
@var text avatar-size "Avatar size" 16px
@var text avatar-spacing "Avatar spacing" 6px
@var checkbox avatar-status-border "Avatar status as border" 1
@var text stroke-size "Stroke size" 3px

@var text textarea-button-space "Text area button space" 10px
@var text emoji-size "Emoji size" 1.975em
==/UserStyle== */

@keyframes dropfade {
	0% {
		opacity: 0;
		transform: translateY(-10px);
	}

	100% {
		opacity: 1;
		transform: translateY(0);
	}
}

dropfade(e = \&) {
	@media (prefers-reduced-motion: no-preference) {
		{e} {
			animation: dropfade var(--trans-dur) cubic-bezier(0.2, 0.9, 0.6, 1);
		}
	}
}

anim(e = \&) {
	@media (prefers-reduced-motion: no-preference) {
		{e} {
			transition: var(--trans-dur);
		}
	}
}

replace-text(content, text-color = var(--text), pos = after) {
	& {
		letter-spacing: -9999px;
		color: transparent !important;
		background-color: transparent !important;

		&::{pos} {
			content: content;
			letter-spacing: 0;
			color: text-color;
		}
	}
}

pos(top = 0, left = 0, bottom = 0, right = 0) {
	top: top;
	left: left;
	bottom: bottom;
	right: right;
}

box(w, h = w) {
	width: w;
	height: h;
}

@-moz-document domain("discord.com") {
	/* Variables */
	:root, section[class*="theme-"] {
		// Settings
		settings = \
			'sidebar-width',
			'channels-padding',
			'header-height',
			'header-icon-size',
			'avatar-border-radius',
			'avatar-size',
			'avatar-spacing',
			'stroke-size',
			'textarea-button-space',
			'emoji-size'

		for i in settings {
			\-\-{i}: convert(i);
		}

		// Settings - other variables
		--message-separator: ' ->';

		// Background
		--background-primary: var(--bg) !important;
		--background-secondary: var(--bg2) !important;
		--background-secondary-alt: var(--bg3) !important;
		--background-tertiary: var(--bg4) !important;
		--background-accent: var(--accent) !important;
		--background-floating: var(--bg) !important;
		--background-mobile-primary: var(--background-primary) !important;
		--background-mobile-secondary: var(--background-secondary) !important;
		--channeltextarea-background: var(--bg) !important;

		--background-modifier-selected: var(--bg) !important;
		--background-modifier-accent: var(--border) !important;

		// Text
		--text-normal: var(--text) !important;
		//--text-muted: var(--text-muted2) !important;
		--text-positive: var(--color10) !important;
		--text-warning: var(--color11) !important;
		--text-danger: var(--color9) !important;
		--text-brand: var(--color12) !important;
		--channels-default: var(--text-muted) !important;
		--header-primary: var(--text-normal) !important;
		--header-secondary: var(--text-muted) !important;
		--interactive-normal: var(--text-muted) !important;
		--interactive-muted: var(--text-muted2) !important;
		--interactive-active: var(--text) !important;
		--interactive-hover: var(--text) !important;

		// Shadows
		--elevation-stroke: 0 0 0 1px var(--border) !important;
		--elevation-low: var(--shadow-low) !important;
		--elevation-medium: var(--shadow-mid) !important;
		--elevation-high: var(--shadow-big) !important;

		// Other
		--focus-primary: var(--hl) !important;
		--brand-experiment: var(--color4) !important;
		--brand-experiment-400: var(--color12) !important;
		--brand-experiment-560: var(--color12) !important;
		--brand-experiment-600: var(--color12) !important;
	}

	/* Scrollbar */
	:root {
		--scrollbar-auto-thumb: var(--colorBorder) !important;
		--scrollbar-auto-track: var(--colorBg) !important;
		--scrollbar-thin-thumb: var(--colorBorder) !important;
		--scrollbar-thin-track: var(--colorBg) !important;
	}
	::-webkit-scrollbar {
		// Normal
		div[class^="quickswitcher"] div[class^="scroller-"]&,
		div[class^="messagesWrapper"] > &,
		div[class^="contentRegionScroller"]& {
			&-thumb, &-track {
				border-top: none !important;
				border-bottom: none !important;
				border-radius: 0 !important;
				margin-bottom: 0 !important;
			}
		}

		// Thin
		[class*="thin-"]& {
			&-button {
				display: none;
			}
			&-track {
				background-color: transparent;
				border: none;
			}
		}
	}

	/**
	 * Start
	**/

	/* Remove elements */
	// I. Buttons
	#message-actions-tts,
	#user-context-call,
	#user-context-note,
	#user-context-message-user,
	#user-context-invite-to-server,
	#guild-header-popout-invite-people,
	a[href="/discovery"],
	a[href="https://support.discord.com"],
	div[aria-label^="Mute channel"],
	#channels div[aria-label="Invite to Server"],
	#channels div[aria-label="Create Invite"],
	div[class^="sidebar"] div[class^="unread"],
	div[class^="sidebar"] div[class^="actionButtons"],
	div[class^="peopleListItem"] div[class^="actions-"],
	nav[aria-label="Private channels"] div[class^="searchBar"],
	div[aria-label="Search Result"] div[class^="buttonsContainer"],
	#messagesNavigationDescription + div[id^="chat-messages"] + div[class^="containerExpanded"],

	// II. Nitro
	a[href="/store"],
	button[aria-label="Send a gift"],
	button[class^="shinyButton"],
	div[class^="premiumPromo-"],
	div[class*="premiumUpsell-"],
	div[class^="premiumIconWrapper"],
	div[class*="premiumInlineNotice"],
	div[class^="bannerNitroUpsell"],
	div[class^="userProfileCustomizationSection"] div[class^="customizationSection"]:nth-child(3),
	#emoji-picker-tab-panel div[class^="listItems"] > div:not([class]),
	#emoji-picker-tab-panel div[class^="listItems"] > hr,
	#user-settings-cog-Discord_Nitro,
	#user-settings-cog-Nitro_Server_Boost,
	#user-settings-cog-Library_Inventory,
	#user-settings-cog-Billing,
	#guild-context-guild-settings--GUILD_PREMIUM,
	#guild-header-popout div[role="group"]:first-child,
	#guild-header-popout div[role="group"]:first-child + div,
	button[aria-label="Open sticker picker"],
	div[aria-controls="GUILD_PREMIUM-tab"],
	div[aria-controls="GUILD_PREMIUM-tab"] + div,
	div[aria-controls="sticker-picker-tab-panel"],
	div[aria-controls="connections-tab"] + div + div,
	div[aria-controls="discord-nitro-tab"],
	div[aria-controls="nitro-server-boost-tab"],
	div[aria-controls="library-inventory-tab"],
	div[aria-controls="billing-tab"],
	div[aria-controls="billing-tab"] + div,

	// III. Made-obsolete gradients
	form::before,
	a[class^="mainContent"]::before, // wtf
	div[class^="option"]::after,
	div[class^="option"][class*="selected"]::before,
	div[class^="children"]::after,
	div[class^="resultsGroup"] svg,

	// FUCK THREADS
	#message-actions-thread,
	div[aria-label="Create Thread"],
	div[class^="threadSuggestionBar"],
	div[class^="toolbar"] > div[aria-label="Threads"],
	div[class^="message"][class*="systemMessage"][class*="hasThread"],

	// IV. Other elements
	ul[data-list-id="guildsnav"] > div[class^="scroller"] > div:nth-last-child(2),
	ul[data-list-id="guildsnav"] > div[class^="scroller"] > div:nth-last-child(3),
	ul[data-list-id="guildsnav"] > div[class^="scroller"] > div:nth-last-child(4),
	div[class^="sidebar"] header, section[aria-label="Channel header"], // nuke everything
	div[aria-label="Servers"],
	//div[class^="sidebar-"],
	nav[class^="wrapper"], // ^
	div[class^="protip"],
	div[class^="socialLinks"],
	div[class^="emptyChannelIcon"],
	div[class^="userPopout"] div[class^="footer"],
	div[data-list-id="chat-messages"] > div[class^="groupStart-"], // blocked
	div[class^="userPopout"] div[class^="bodyInnerWrapper"] > h3:last-of-type, // notes
	div[class^="userPopout"] div[class^="bodyInnerWrapper"] div[class^="note-"], // ^
	div[class^="infoScroller"] div[class^="userInfoSection"]:first-child,
	div[aria-modal] div[class^="message"] + div[class^="spacingTop"],
	//div[aria-label="USER_SETTINGS"] div[class^="formNotice"],
	div[class^="chatHeaderBar"],
	div[class^="channelNotice"],
	div[class*="browserNotice"],
	div[class^="peopleColumn"] h2,
	div[class^="autocomplete"] h3,
	div[class^="nowPlayingColumn"],
	div[aria-hidden="true"] div[class^="attachment"], // skeleton
	#chat-messages > div[class^="wrapper"] div[class*="blob"] // ^
	{
			display: none !important;
	}

	// GIFs / emojis tabs
	div[class^="resizeHandle"] + div {
		grid-template-rows: unset !important;

		& > nav {
			display: none;
		}
	}

	// Timestamp
	span[class*="timestamp-"] {
		display: none;
	}
	div[class^="message"][class*="compact"] > div[class^="contents"] {
		margin-left: -4.75rem !important;
	}

	// E-mail & phone number
	div[class^="accountProfileCard"] {
		& > div:last-child {
			display: none;
		}
		div[class^="userInfo-"] {
			height: 80px !important;
		}
	}

	// V. Fixes
	div[class^="userInfoSection"] + div[class^="userInfoSection"] {
		border-top: none !important;
	}

	/* Hide the sidebar on small windows */
	@media (max-width: 768px) {
		// Chat
		.sidebar-2K8pFh { // class for animation performance
			width: 0 !important;
			min-width: 0 !important;
			anim('div[class^="sidebar"]');

			if sidebar-overlay {
				background-color: var(--bg-tr) !important;
				backdrop-filter: var(--popup-filter);
				box-shadow: var(--shadow-vrt);
				position: absolute;
				top: 0;
				bottom: 0;
				z-index: 101;

				& > * {
					background-color: transparent !important;
				}
			}

			nav[class^="wrapper"]:hover + div &,
			nav[class^="wrapper"] + div &:hover {
				width: var(--sidebar-width) !important;
			}
		}
		nav[class^="wrapper"] div[class^="scroller"] {
			box-shadow: inset -1px 0 var(--background-modifier-accent);
		}

		// Settings
		div[aria-label$="SETTINGS"] div[class^="sidebarRegion"]:not(:hover) {
			flex: 1 0 16px !important;
		}

		// xd
		div[class^="sidebar-"] + div[class] > section {
			background-color: var(--accent) !important;
		}
	}

	/* Members on toolbar hover (mostly stolen from \xynstr) */
	.membersWrap-2h-GB4 { // class for animation performance
		position: absolute;
		top: 0;
		bottom: 0;
		right: 0;
		min-width: unset;
		z-index: 100;

		& > div {
			box-shadow: var(--shadow-vrt);
			anim();
		}

		&:not(:hover) > div {
			width: 0 !important;
		}

		&:hover {
			background-color: var(--bg-tr) !important;
			backdrop-filter: var(--popup-filter);
			border-left: 1px solid var(--accent-border);

			& > div, & > div > div {
				background-color: transparent !important;
			}

			&::after {
				background: var(--interactive-hover);
			}
		}

		&::after {
			content: '';
			position: absolute;
			box(var(--header-icon-size), var(--header-height));
			top: calc(var(--header-height) * -1);
			right: 0;
			background: var(--interactive-normal);
			margin: 0 16px;
			-webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' x='0' y='0' class='icon-22AiRD da-icon' aria-hidden='false' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='currentColor' fill-rule='evenodd' clip-rule='evenodd' d='M14 8.00598C14 10.211 12.206 12.006 10 12.006C7.795 12.006 6 10.211 6 8.00598C6 5.80098 7.794 4.00598 10 4.00598C12.206 4.00598 14 5.80098 14 8.00598ZM2 19.006C2 15.473 5.29 13.006 10 13.006C14.711 13.006 18 15.473 18 19.006V20.006H2V19.006Z'%3E%3C/path%3E%3Cpath fill='currentColor' fill-rule='evenodd' clip-rule='evenodd' d='M14 8.00598C14 10.211 12.206 12.006 10 12.006C7.795 12.006 6 10.211 6 8.00598C6 5.80098 7.794 4.00598 10 4.00598C12.206 4.00598 14 5.80098 14 8.00598ZM2 19.006C2 15.473 5.29 13.006 10 13.006C14.711 13.006 18 15.473 18 19.006V20.006H2V19.006Z'%3E%3C/path%3E%3Cpath fill='currentColor' d='M20.0001 20.006H22.0001V19.006C22.0001 16.4433 20.2697 14.4415 17.5213 13.5352C19.0621 14.9127 20.0001 16.8059 20.0001 19.006V20.006Z'%3E%3C/path%3E%3Cpath fill='currentColor' d='M14.8834 11.9077C16.6657 11.5044 18.0001 9.9077 18.0001 8.00598C18.0001 5.96916 16.4693 4.28218 14.4971 4.0367C15.4322 5.09511 16.0001 6.48524 16.0001 8.00598C16.0001 9.44888 15.4889 10.7742 14.6378 11.8102C14.7203 11.8418 14.8022 11.8743 14.8834 11.9077Z'%3E%3C/path%3E%3C/svg%3E") center/header-icon-size no-repeat;
		}
	}

	div[aria-label="Hide Member List"] {
		order: 1;
		pointer-events: none;

		path {
			display: none;
		}
	}

	/* Windows titlebar (stolen from Metro for Discord) */
	/*div[class^="titleBar"] {
		background-color: var(--background-primary);

		div[class^="wordmarkWindows"] {
			color: var(--text-normal);

			&::after {
				content: 'Discord';
				top: 9px;
				left: 12px;
				display: block;
				position: absolute;
				font-size: 12px;
				font-weight: 400;
				line-height: 15px;
			}

			svg {
				display: none;
			}
		}
		&[class*="withFrame"] {
			height: 28px;
		}
		div[role="button"] {
			width: 45px;
			height: 32px;
			color: var(--text-normal);
		}
		div[class^="winButtonClose"]:hover {
			background-color: #e81123;
		}
	}*/

	/* Border radius */
	video,
	button,
	input,
	textarea,
	div[class^="imageWrapper"],
	div[class^="accountList"],
	div[class^="accountProfileCard"],
	div[class^="attachment-"],
	div[class^="audioControls"],
	div[class*="auditLog"],
	div[class^="background-"],
	div[class^="unread"] div[class^="bar"],
	div[class^="blockquote"],
	div[class*="card"],
	div[class^="checkbox"],
	a[class*="container"],
	div[class^="connection"],
	div[class*="connectedAccount"],
	div[class^="css"],
	[class*="embed"]:not(img),
	a[class*="embedImage"] img,
	a[class*="embedImage"] video,
	a[class*="embedThumbnail"] img,
	a[class*="embedThumbnail"] video,
	a[class*="embedVideo"] img,
	a[class*="embedVideo"] video,
	div[class^="ghostPill"],
	div[class^="hasMore"],
	div[class^="invite"],
	div[class^="input-"],
	div[class*="item"],
	div[class^="jumpButton"],
	div[class^="layout"],
	div[class^="markup"] code.inline,
	div[class^="menu"],
	div[class^="message-"],
	div[class*="notDetected"],
	div[class*="nowPlaying"],
	div[class^="option"],
	div[class^="reaction"],
	//div[class^="searchBar-"],
	div[class^="searchResult-"],
	div[class^="selector"],
	div[class^="swatch"],
	span[class^="questionMark"],
	div[class^="userPopout"],
	div[class^="uploadModal"] img,
	div[class^="message"] div[class^="markup"] div[class^="wrapper"],
	.wrapper-2TxpI8,
	.mention,
	.hljs
	{
		border-radius: var(--border-radius) !important;
	}
	div[class^="iconVisibility"] div[class^="content"],
	div[class^="item"]:not([role="menuitem"])
	{
		border-radius: var(--border-radius) 0 0 var(--border-radius) !important;
	}
	div[class^="tabBarItem"]
	{
		border-radius: var(--border-radius) var(--border-radius) 0 0 !important;
	}
	.footer-2gL1pp
	{
		border-radius: 0 0 var(--border-radius) var(--border-radius) !important;
	}

	/* More/less compact view */
	div[class^="connectionDelete"] {
		top: 16px !important;
		right: 16px !important;
	}
	div[class^="ghostPill"] {
		padding: 6px 8px !important;
	}
	div[class*="auditLog"] > div[class^="header"] {
		padding: 10px !important;
	}
	div[class^="sidebar"] a[href^="/channels/@me"] {
		padding: 0 !important;
		margin: 1px 0 0 8px !important;
	}
	h2[class^="privateChannelsHeader"] {
		padding: 12px 6px 4px 12px !important;
		margin: 8px 0 0 8px;
	}
	section[aria-label="User area"] div[class^="container"] + div {
		height: 50px !important;
		margin-bottom: 0 !important;
	}
	div[class^="peopleColumn"] > div {
		padding-top: 24px;
	}
	div[class^="infoScroller"] {
		padding: 0 16px !important;
	}
	div[class^="grid"] {
		padding: 0 10px 10px !important;
	}
	div[id^="popout"]:not([class^="layer"]) div[class^="container"]:not(#search-results) {
		padding: 0 !important;
		margin-top: 16px !important;
		margin-left: 16px;
		margin-right: 9px;
	}
	div[class^="toolbar"] > div[class^="search"] {
		margin: 0 2px !important;
	}
	button[class*="barButtonBase"] {
		padding: 0 8px !important;
	}
	div[class^="messagesErrorBar"] {
		padding-bottom: 0 !important;
	}

	/* Header blur */
	/*div[class^="sidebar"] header,
	div[class^="chat"] > section {
		position: absolute !important;
		background-color: var(--bg-tr) !important;
		backdrop-filter: var(--popup-filter);
	}
	div[class^="sidebar"] {
		header {
			width: 100%;
		}
		[class*="hasBanner"] {
			div[class^="container"]:not(&) ~ #channels div[style="height: 84px;"] {
				height: 135px !important;
			}
			& ~ #channels > div,
			& > nav > div& {
				& > header {
					background-color: transparent !important;
					backdrop-filter: none;
				}
				& > div {
					margin-top: 0 !important;
				}
			}
		}
	}
	div[class^="sidebar"] #channels > div,
	div[class^="sidebar"] div:not([class*="hasBanner"]) > header + div,
	div[class^="sidebar"] div[class^="unreadTop"],
	#messagesNavigationDescription + div,
	main + section,
	div[class^="chat"] > div > div:not([class^="root"]) {
		margin-top: 48px;
	}
	div[class^="newMessagesBar"] {
		top: 48px !important;
	}
	div[class^="chat"] > div::before {
		top: 47px !important;
	}

	/* Channels */
	$chat-header = 0;
	#private-channels,
	div[class^="sidebar-"] > *,
	div[class^="sidebarRegionScroller-"] {
		box-shadow: inset -1px 0 var(--accent-border);
	}

	// Chat
	#channels {
		&::-webkit-scrollbar,
		div[class^="unread"] {
			display: none;
		}

		div[class^="iconVisibility"]:not([class*="clickable"]) {
			padding: 0 !important;

			& > div {
				margin-left: 0 !important;
				padding: 0 calc(var(--channels-padding) * 2) !important;
			}

			div[class^="name"] {
				font-size: 14px !important;
			}

			&:not([class*="mode"]) a:hover div[class^="name"] {
				color: var(--interactive-normal) !important;
			}

			&[class*="modeSelected"] > div {
				box-shadow:
					inset 1px 0 var(--accent-border),
					0 -1px var(--accent-border),
					0 1px var(--accent-border),
					var(--shadow-low);

				[class^="mainContent"] {
					cursor: default !important;
				}

				svg {
					color: var(--interactive-active) !important;
				}
			}

			&[class*="modeUnread"] {
				svg, div:not([class^="numbersBadge"]) {
					color: var(--hl) !important;
				}
			}
		}

		div[class^="voiceUser"][class*="selected"] > div {
			box-shadow:
				inset 1px 0 var(--accent-border),
				0 -1px var(--accent-border),
				0 1px var(--accent-border),
				var(--shadow-low);
		}

		if channels-compact {
			[class^="mainContent"] {
				padding: var(--channels-padding) 0 !important;
			}

			div[class^="list-"] {
				padding-left: 16px !important;

				& > div, & > div > div {
					height: 28px !important;
				}
			}

			div[class^="iconVisibility"]:not([class*="clickable"]) svg {
				box(16px);
			}
		}
	}

	// Settings
	div[aria-label$="SETTINGS"] div[class^="sidebarRegionScroller"] {
		&::-webkit-scrollbar {
			display: none;
		}

		& > nav {
			padding-right: 0 !important;
		}

		div[class^="item"] {
			if channels-compact {
				margin-bottom: 0 !important;
				line-height: unset !important;
			}

			&:not([aria-selected="true"]) {
				color: var(--interactive-normal);
				// NO !important to not interfere with hardcoded-color()
			}

			&[aria-selected="true"] {
				box-shadow:
					inset 1px 0 var(--accent-border),
					0 -1px var(--accent-border),
					0 1px var(--accent-border),
					var(--shadow-low);

				&:hover {
					background-color: var(--background-primary) !important;
				}
			}
		}
	}

	/* Chat header (move?) */
	div[class^="sidebar-"] {
		div[class^="scroller"] {
			box-shadow: inset -1px 0 var(--accent-border);
		}
		& > nav {
			box-shadow: none;
		}
		& + div > section {
			background-color: var(--background-secondary) !important;
			box-shadow: 0 1px var(--accent-border);
		}
	}

	/* Header(s) */
	div[class^="sidebar"] header, section[class^="title"] {
		height: var(--header-height) !important;
	}
	section[class^="title"] {
		div[aria-label="Text Channel"] {
			margin: 0 6px !important;
			height: var(--header-icon-size) !important;

			svg {
				box(var(--header-icon-size));
			}
		}

		div[class^="toolbar"] {
			div[class^="searchBar"],
			& > div[role] {
				height: var(--header-icon-size) !important;

				div[aria-label="Clear search"], svg,
				/#app-mount div[aria-label="Clear search"] > div {
					box(var(--header-icon-size));
				}
			}
		}
	}

	/**
	 * Popup
	**/

	/* Transparent background and blur, to rewrite? */
	/*:root {
		--background-floating: var(--bg-tr) !important;
	}

	div[role="dialog"]:not([class]) > div,
	div[aria-label="Pinned Messages"] div[class^="header"],
	div[aria-label="Recent Mentions"] div[class^="header"] {
		background-color: var(--background-transparent-primary) !important;
	}
	div[class^="messageGroupWrapper"],
	div[class^="messageContainer"],
	div[class^="channelTextArea"] > div[class^="autocomplete"] {
		background-color: var(--background-transparent-secondary) !important;
	}
	div[class^="channelHeader"] {
		background-color: var(--background-transparent-secondary-alt) !important;
	}
	div[class^="messageGroupWrapper"] {
		border-color: var(--background-transparent-secondary) !important;
	}
	div[class^="unreadTop"] > div,
	div[class*="tooltipPrimary"] {
		opacity: 1 !important;
		background-color: var(--background-floating) !important;
		backdrop-filter: var(--popup-filter);
	}
	div[class^="unreadTop"] > div {
		color: var(--text-normal) !important;
	}
	div[class^="userPopout"],
	div[class^="autocomplete"],
	div[class^="root"]:not([class*="rolesList-"]),
	div[class^="menu"] {
		backdrop-filter: var(--popup-filter);
	}
	div[class^="bodyInnerWrapper"] {
		background-color: transparent !important;
	}

	/* Recent mentions */
	/*.theme-dark div[aria-label="Inbox"] svg {
		background-size: 24px !important;

		&:hover {
			filter: brightness(1.25);
		}

		path {
			display: none;
		}
	}
	.theme-light div[aria-label="Inbox"] svg {
		background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDIwMDEwOTA0Ly9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9UUi8yMDAxL1JFQy1TVkctMjAwMTA5MDQvRFREL3N2ZzEwLmR0ZCI+CjxzdmcgdmVyc2lvbj0iMS4wIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiB3aWR0aD0iMzIuMDAwMDAwcHQiIGhlaWdodD0iMzIuMDAwMDAwcHQiIHZpZXdCb3g9IjAgMCAzMi4wMDAwMDAgMzIuMDAwMDAwIgogcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCI+CjxtZXRhZGF0YT4KQ3JlYXRlZCBieSBwb3RyYWNlIDEuMTYsIHdyaXR0ZW4gYnkgUGV0ZXIgU2VsaW5nZXIgMjAwMS0yMDE5CjwvbWV0YWRhdGE+CjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAuMDAwMDAwLDMyLjAwMDAwMCkgc2NhbGUoMC4xMDAwMDAsLTAuMTAwMDAwKSIKZmlsbD0iIzAwMDAwMCIgc3Ryb2tlPSJub25lIj4KPC9nPgo8L3N2Zz4K);
	}
	.theme-dark div[aria-label="Inbox"] svg {
		background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAOSSURBVFhH7ZbLTxNBHMfRblu2D6iglJaXhrcEjcEHiaDESDwYDyY+jhr04NFXoiaeNR4k/gFqOJkIFy960YOKGiQaIQR5lShSCi0CbbfvBzjfcQfX7i4tBk7ySZrfzG+38/vO7G9+M1kb/PdsEm1GjI6Nl8VisduCEDiVTCb1wVCIh99oMIS1Oq2Xz87u0ev17dVVFe/oHzIgIwEI7Pf7X83NL1SIrhXJz9viyMnJOVpVWT4hulRJK2BgcOihx+NpSySS9F2LJXfGYDA813Lcy5rqyqfwDY+MnY0nEq2hUOi41+srhI/jNEt2W+HV2prqB+irsaIABHe5pi+gjcCW3NzT6ZZ3ZNTR5PX5upgQu932qL6u9iJ9qICqgMGvw3edU66baKcbRIm+/oHXbs/sYbRLS4quqK2EogB880mn8xuW3VZofbarvu6k+GhVMBH4HCXFxTuUckJRwKfPXxwk4cqx7Af2NdhE9zIYOByO7PYLggU7wGQyfiSBWvDsWOuRv8b80NO7QHaNhSTm+N6GPbIk3izaZTB7BEcb35w6JXS/7wlhVgiOPrYiC65Efl7eCViMibGpU4JMQCQSod8Ks09NOMycZDqv0WiW8F0xW1j0xVdkYAyMhTYbW4pMQDgSaYQ1GY0d1CFBCAT3wxbZ/2wvWJIn99BWA9sWNhAMylZKLiAc3gpLZtVHHRIwe9jUjK7bWXNLbCqCmgG7mFzUU4cEmYBoNMbBsiKzFrCxWOmWIhOwHiglH0MmQK/XJWBRXqljDYjH45dgSS6EqUOCTIBOpwvAorZThwQ2wNDwyGXqEEHVFJuy2aI/+3PuOtpkNzyhTgkyAQae74eNRiKyjDWbjL2wrumZdiYCdsbtvoE2mJub78N5gB8Rdoe864hGoxzEK5VzWSXEH79P/OhGe3tZaXNqLUAhYrtBCgKQQNnkniAbE8+sBdtqlUqxbAWkhYOcap3UKaH5YKOBDPbGbDZ50UfOoA9/SXHRIZRc+iIBgXGQ4Zna3UDxLMAqTDqn3mI2/3ISrgbFbYhVsFoLHqON+wDuBfTBOqC4AoyUC8k0OZzOpOZEKuKFpDMei1uayNKLblVWFAAgwu32tLHkwn2P5/kujuNeMDEISvb6OXLYtLB7Iw4o6ZmhRloBAAEEQehgx3Q6kIhms/l8utUCGQlgQAjZatdwYpJLhpWtCrJdp9P6xGv5/UwCb7DBb7KyfgEl+bkEE7CzgAAAAABJRU5ErkJggg==)
	}*/

	div[aria-label="Recent Mentions"] {
		// Remove elements
		div[class^="tab"]:last-child,
		div[data-list-id="recents"] + div {
			display: none;
		}

		// Unsticky headers
		div[class^="channelHeader"] {
			position: unset !important;
		}

		// Return old header
		div[class^="header"] {
			box-shadow: var(--elevation-low) !important;
		}
		div[class^="tab"][class*="active"] {
			height: unset !important;
			margin: 0 !important;
			padding: 0 !important;
			replace-text('Recent Mentions', var(--header-primary));
		}
	}

	/* Menu children in parent
	 * causes massive lag..what ? ? */
	/*div[aria-activedescendant] div[class^="layer"] {
		&[style*="position: fixed"] {
			position: unset !important;

			div[role="menu"] {
				box-shadow: none !important;
				background: none !important;
				width: calc(100% + 8px);
			}
			& > div[role="menu"] > div,
			& > div {
				padding: 0 !important;
			}
			& > div {
				padding-left: 8px;
			}
			& > div[class^="submenuPadding"] div[class^="scroller"] {
				padding: 6px 0 !important;
			}
			div[class^="scroller"] {
				div[class^="item"] {
					width: calc(100% - 12px);
					left: 6px;
				}
				div[class^="separator"] {
					margin: 8px !important;
				}
			}
		}
		&[style*="position: absolute"] div[class^="submenuContainer"] + div {
			border-top: 2px solid var(--background-modifier-accent);
			padding-top: 16px;
		}
	}

	/* Vivaldi-like modals (and menu) (quickswitcher for now) */
	:root {
		--deprecated-quickswitcher-input-background: var(--bg) !important;
		--deprecated-quickswitcher-input-placeholder: var(--text-muted) !important;
	} // #e5d7da def

	div[id^="popout"], // recent mentions, etc.
	#app-mount > div[class^="popouts"] > div,
	div[class^="layerContainer"] > div > div[role="menu"],
	div[class^="layer"] div[class^="animatorRight"] {
		dropfade();
	}

	div[class^="backdrop"] {
		opacity: 0 !important;

		& ~ div div[aria-modal]:not([class^="inner"]) > div,
		& + div div[class^="quickswitcher-"],
		& + div div[class^="uploadModal-"] {
			background-color: var(--background-floating) !important;
			box-shadow: var(--elevation-stroke), var(--elevation-high) !important;
			border-radius: var(--border-radius) !important;
			dropfade();
		}
		& + div div[style^="opacity: 0"],
		& + div div[style^="opacity: 1"] {
			opacity: 1 !important;
		}
	}

	// fix for "open original"
	div[class^="layer"] div[class^="imageWrapper"] + a {
		color: var(--text-link) !important;
		opacity: 1 !important;

		&:not(:hover) {
			text-decoration: none;
		}
	}

	div[class^="quickswitcher-"] {
		$qs-result-height = 28px;
		$qs-padding-h = 10px;

		padding: 0 !important;

		input {
			border-radius: var(--border-radius) !important;
			box-shadow: none !important;
			padding: 15px 12px 12px 40px;
			line-height: unset !important;
			text-overflow: ellipsis;

			& + div {
				border-top: 1px solid var(--background-tertiary);
				z-index: 1;
			}
	
			&:focus + div {
				border-top-color: var(--hl);
				box-shadow: 0 -1px var(--hl);
			}
		}

		div[class^="scroller"] {
			border-radius: 0 0 var(--border-radius) var(--border-radius);
			margin: 0 !important;

			& > div {
				height: auto !important;

				& > div:not([class]) > div {
					padding: 0 !important;

					& > div {
						text-transform: unset !important;
						letter-spacing: unset !important;
						border-bottom: 1px solid var(--background-tertiary);
						padding: 6px 6px 5px 12px;
						margin-top: 0 !important;
						width: 100%;
					}

					&, & > div {
						height: $qs-result-height !important;
						display: flex;
						align-items: center;
					}
				}
			}
		}

		div[role="option"] {
			border-radius: 0 !important;
			height: $qs-result-height !important;

			& > div {
				padding: 0 $qs-padding-h !important;
				height: $qs-result-height !important;
				line-height: $qs-result-height !important;
			}

			span[class^="note-"] {
				text-transform: unset !important;
			}

			&[aria-selected="true"] {
				background-color: var(--hl) !important;

				svg, span, div[class^="misc-"] {
					color: var(--hl-text) !important;
				}
			}

			&[aria-selected="false"] div[class^="contentUnread"] svg {
				color: var(--header-primary) !important;
			}
		}

		div[style="height: 15px;"] {
			display: none;
		}
	}

	div[class^="topSection"] {
		background-color: var(--background-secondary) !important;

		& > div[class^="tabBarContainer"] {
			border-bottom-color: var(--border) !important;

			& > div {
				height: unset !important;
				transform: translateY(1px);
			}

			div[role="tab"] {
				border: 1px solid transparent;
				border-bottom: none !important;
				padding: 8px !important;
				margin-right: 0 !important;

				&[aria-selected="true"] {
					background-color: var(--background-floating) !important;
					border-color: var(--border) !important;
				}

				&[aria-selected="false"]:hover {
					background-color: var(--background-secondary-alt) !important;
					color: var(--interactive-normal) !important;
				}
			}
		}
	}

	/**
	 * Chat
	**/

	/* Custom avatar rounded */
	div[class^="avatar"] > div[class^="wrapper"],
	div[aria-modal] div[class^="avatar-"],
	div[class^="avatarUploaderInner"]:not([class*="Square"]),
	div[class^="avatarHintInner"],
	img[class^="replyAvatar"],
	img[class^="avatar-"] {
		border-radius: var(--avatar-border-radius) !important;
	}
	foreignObject[mask^="url(#svg-mask-avatar-status-mobile"],
	foreignObject[mask^="url(#svg-mask-avatar-status-round"],
	foreignObject[mask="url(#svg-mask-avatar-default)"],
	div[class^="avatar"] > svg[class^="mask"] > foreignObject {
		mask: none !important;
		border-radius: var(--avatar-border-radius);
	}
	div[class^="userPopout"] div[class^="avatarWrapperNormal"] {
		& > div {
			border-width: var(--stroke-size) !important;
		}

		& > svg {
			top: var(--stroke-size) !important;
			left: var(--stroke-size) !important;
		}
	}
	rect[mask^="url(#svg-mask-status"]:not([mask$="mobile)"]),
	div[class^="avatar"] rect {
		rx: 50%; ry: 50%;
		stroke: var(--background-floating);
		stroke-width: var(--stroke-size);

		div[class^="userPopout"] & {
			x: 64; y: 64;
			stroke-width: calc(var(--stroke-size) * 1.5);
		}

		div[aria-label="User Profile Modal"] & {
			x: 98; y: 98;
			stroke-width: calc(var(--stroke-size) * 2);
		}
	}

	/* Avatar status border */
	if avatar-status-border {
		div[class^="avatar-"], div[class^="avatar-"] > div[class^="wrapper"] {
			// Size
			div[aria-label="Members"] &, div[data-list-id="people"] &, #private-channels &, section & {
				--avatar-border-size: 2px;
			}
			div[class^="userPopout"] &, div[aria-label="User Profile Modal"] &, div[class^="accountProfileCard"] & {
				--avatar-border-size: 6px;
			}

			// Color
			--avatar-border-color: var(--text-muted);
			&[aria-label$="Online"], &[aria-label$="mobile"] {
				--avatar-border-color: var(--text-positive);
			}
			&[aria-label$="Idle"] {
				--avatar-border-color: var(--text-warning);
			}
			&[aria-label$="Disturb"] {
				--avatar-border-color: var(--text-danger);
			}

			// Border
			border: var(--avatar-border-size) solid var(--avatar-border-color);

			rect {
				display: none;
			}
		}

		// Fixes
		div[class^="avatar-"] {
			div[aria-label="Members"] &, #private-channels & {
				border: none !important;
				width: 36px !important;
			}
			div[data-list-id="people"] &, section & {
				border-radius: var(--avatar-border-radius) !important;
			}
		}
	}

	/* Avatar in same line as name */
	div[data-list-id="chat-messages"] > div[role="listitem"] {
		&[class*="cozy"] {
			padding-left: 68px !important;

			& > div[class^="contents"] > div[class^="markup"],
			& > div[class^="container"] {
				margin-left: -48px !important
				padding-left: 0 !important;
			}

			h2 {
				margin-left: calc(-48px + var(--avatar-spacing) + var(--avatar-size));
				min-height: unset !important;
				height: var(--avatar-size);
				display: flex !important;
				align-items: center;

				& > span[class^="timestamp"] {
					height: unset !important;
				}

				& + div {
					margin-top: avatar-size > 16px ? calc(var(--avatar-size) - 16px) : 4px;
				}

				~/ img[class^="avatar"] {
					margin-top: 0 !important;
				}
			}

			img[class^="avatar"] {
				box(var(--avatar-size));
			}
		}

		&[class*="selected"]:not([class*="zalgo"]) { // wtf is zalgo
			padding-left: 20px !important;

			h2 {
				margin-left: calc(var(--avatar-spacing) + var(--avatar-size));
			}
		}

		&[class*="hasThread"]::after { // unsupported
			display: none;
		}
	}

	/* Timestamp / username / separator */
	div[data-list-id="chat-messages"] > div[class^="message"],
	div[data-list-id="pins"],
	div[class^="preview"] > div {
		// Timestamp
		span[class*="timestampVisibleOnHover"]:not(:hover) {
			opacity: .25 !important;
		}

		&[class*="groupStart"] {
			span[class*="timestamp"]:not(:hover) {
				opacity: 1 !important;
			}

			& + div:not([class*="groupStart"]) {
				span[class*="timestampVisibleOnHover"]:not(:hover) {
					opacity: .75 !important;
				}

				& + div:not([class*="groupStart"]) {
					span[class*="timestampVisibleOnHover"]:not(:hover) {
						opacity: .5 !important;
					}

					& + div:not([class*="groupStart"]) {
						span[class*="timestampVisibleOnHover"]:not(:hover) {
							opacity: .25 !important;
						}
					}
				}
			}
		}

		// Username
		h2 span {
			//margin-left: 0 !important;
			margin-right: 0 !important;
		}
		span[class^="username"] {
			&:not(:hover) {
				color: var(--text-muted) !important;
				filter: none !important;
			}

			// Output: 'that > span[class^="username"]::after'
			div[class^="repliedMessage"] > ^[1..-1]::after {
				content: var(--message-separator);
				display: inline-block;
				color: var(--text-muted);
			}
		}

		// Separator
		&:not([class*="systemMessage"]) i {
			color: var(--text-muted);
			position: unset !important;
			opacity: unset !important;
			display: unset !important;
		}
		span[class^="username"] + i {
			replace-text(var(--message-separator), var(--text-muted));
		}
	}

	/* Member group */
	div[aria-label="Members"] h2 {
		padding-top: 16px !important;
		height: 36px !important;

		&:not(:first-of-type) {
			border-top: 1px solid var(--background-secondary-alt);
			margin-top: 12px;
		}
	}

	/* Message box */
	div[class^="channelTextArea"] > div::-webkit-scrollbar {
		display: none;
	}
	button[class^="attachButton"] {
		height: 100% !important;
		padding: 10px var(--textarea-button-space) !important;
		margin-right: var(--textarea-button-space);
		border-right: 1px solid transparent;
	}
	button[aria-label="Open GIF picker"] > div {
		padding: 10px var(--textarea-button-space);
		padding-right: 0;
		margin-left: 0 !important;
		border-left: 1px solid transparent;
	}
	button[class^="attachButton"],
	button[aria-label="Open GIF picker"] div {
		border-image: linear-gradient(
				transparent 15%,
				var(--background-primary) 15%,
				var(--background-primary) 85%,
				transparent 85%
		) 1;
	}

	/**
	 * etc
	**/

	/* Search */
	div[class^="toolbar"] > div[class^="search"] {
		order: -1;

		& > div:not([class*="open"]) > div {
			width: 240px !important;
			anim();

			&:not(:hover) {
				background-color: transparent !important;
				width: 28px !important;
			}
		}

		div[role="button"] > div {
			box(20px);
			stroke: var(--interactive-normal);

			svg {
				color: var(--interactive-normal) !important;
			}
		}

		.DraftEditor-root {
			line-height: header-icon-size >= 20px ? 20px : var(--header-icon-size) !important;
		}
	}

	/* Make sidebar resizeable */
	div[class^="sidebar-"] {
		resize: horizontal;
		min-width: 156px;
		max-width: var(--sidebar-width);
	}

	/* Gradient */
	div[role="menu"] {
		border-radius: 0 !important;
		border-top: 2px solid;
		border-image: linear-gradient(
			to right,
			var(--accent),
			var(--accent-border)
		) 1;
	}

	/* Center user area */
	section[aria-label="User area"] {
		div[class^="nameTag"] {
			display: none;
		}

		& > div {
			justify-content: center;
		}
	}

	/* Codeblock information (stolen from gk) */
	code.hljs:not(.inline)::before {
		content: attr(class) !important;
		float: right;
		display: block;
		width: auto;
		max-width: 5.3rem !important;
		min-width: auto;
		margin-top: -8.2rem !important;
		line-height: 1.6rem !important;
		overflow-x: hidden;
		text-align: right;
		font-size: 0.8rem;
	}

	/* Calls */
	div[class^="participantsWrapperAnimated"] {
		display: none;
	}
	div[class^="callContainer"] > div > div {
		padding-right: 8px !important;
	}

	/* They are not "Apps" */
	#user-context-apps div[class^="label"],
	#message-actions-apps div[class^="label"] {
		replace-text('Commands', var(--text-normal));
	}

	/* Remove spoilers (completely) */
	span[class^="spoilerText"] {
		background-color: transparent !important;
	}

	/* Blur */
	div[class^="audioControls"], div[class^="videoControls"] {
		backdrop-filter: var(--popup-filter);
	}

	/* Inconsistencies */
	section[class^="title"] > div[class^="children"] svg,
	div[role="menu"] div[class^="item"][class*="colorDefault"]:not(:hover) {
		color: var(--text-normal) !important;
	}
	div[class^="sidebar"] > section > div[class^="wrapper"] > div {
		border-bottom: 1px solid var(--background-tertiary) !important;
	}
	h2[class^="privateChannelsHeader"] {
		border-top: 1px solid var(--background-modifier-accent);
	}
	div[class^="embedWrapper"] {
		border-left-width: 2px !important;
	}
	main > div > div[class*="barBase"] {
		left: 0 !important;
		border-radius: 0 !important;
	}
	button[class^="button"][class*="enabled"]:hover {
		background-color: unset !important;
	}
	div[class^="layer-"] > div[class^="tooltip"] {
		box-shadow: var(--elevation-medium) !important;
	}
	div[class^="repliedMessage"]::before {
		border-top-left-radius: var(--border-radius) !important;
	}
	.emoji.jumboable {
		width: var(--emoji-size);
		height: var(--emoji-size);
		min-height: var(--emoji-size);
	}
}
