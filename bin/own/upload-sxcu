#!/bin/zsh

setopt extendedglob
local -A jsondata

a=(${"${(f)$(<$1)}"##[[:space:]]##})
for (( i = 2; i < $#a; i++ )) {
	IFS=' :' read -r k v <<< $a[$i]
	k=${k//\"}
	v=${v//\"}

	case $k {
		Arguments) in_arguments=1 ;;
		'},') in_arguments=0 ;;

		*)
			v=${v%,}
			jsondata[$k]=$v
			(( in_arguments )) && [[ $v ]] &&
				args+="-F $k=$v "
			[[ $v ]] &&
				printf '%s => %s\n' $k $v
		;;
	}
}

printf 'curl %s -F "%s=@%s %s\n' \
	$args $jsondata[FileFormName] $1 $jsondata[RequestURL]
#printf '%q => %q\n' "${(@kv)jsondata}"
#printf 'curl %s\n' ${(kv)jsondata}
